<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.wowoniu.fendian.mapper.MemberStatisticMapper">

    <!-- 根据父级用户ID获取会员用户集合 以团队人数倒叙 limit 取数据量 -->
    <select id="getUserList" resultType="com.wowoniu.fendian.model.Member">
        SELECT * FROM member WHERE user_id = #{userId}
        <if test="phone != null">
            AND phone = #{phone}
        </if>
        <if test="name != null">
            AND nick_name LIKE concat('%',#{name},'%')
        </if>
        ORDER BY create_time DESC
        LIMIT #{startRow},#{pageSize}
    </select>

    <!-- 用户总数 -->
    <select id="searchUserCount" resultType="java.lang.Integer">
        SELECT COUNT(*) FROM `user` u LEFT JOIN link_member_user lmu ON lmu.buy_id = u.open_id
        <if test="phone != null">
            AND u.phone = #{phone}
        </if>
        <if test="name != null">
            AND u.nick_name LIKE concat('%',#{name},'%')
        </if>
        WHERE lmu.user_id = #{userId}
    </select>

    <select id="searchMemberConsume" resultType="java.lang.Integer">
        SELECT COUNT(*) FROM member_consume
    </select>
    <select id="getMemberConsumeList" resultType="com.wowoniu.fendian.model.MemberConsume">
        SELECT * FROM member_consume
        ORDER BY time DESC
        LIMIT #{startRow},#{pageSize}
    </select>

</mapper>